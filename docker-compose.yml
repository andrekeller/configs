version: '2'

services:
  database:
    image: postgres
    environment:
      POSTGRES_DB: configs
      POSTGRES_USER: configs
      # INSECURE DEFAULT CHANGE THIS!
      POSTGRES_PASSWORD: configs

  app:
    build: .
    environment:
      CONFIGS_ENCDATA_FIELDS: 'location role flavor'
      CONFIGS_DATABASE_HOST: database
      CONFIGS_DATABASE_USER: configs
      # INSECURE DEFAULT CHANGE THIS!
      CONFIGS_DATABASE_PASSWORD: configs
      CONFIGS_DATABASE_SCHEMA: configs
      CONFIGS_DJANGO_DEBUG: 'no'
      # INSECURE DEFAULT CHANGE THIS!
      CONFIGS_SECURITY_ALLOWED_HOSTS: '*'
      # INSECURE DEFAULT CHANGE THIS!
      CONFIGS_SECURITY_CSRF_COOKIE_SECURE: 'no'
      # INSECURE DEFAULT CHANGE THIS!
      CONFIGS_SECURITY_SESSION_COOKIE_SECURE: 'no'
      # INSECURE DEFAULT CHANGE THIS!
      CONFIGS_SECURITY_SECRET_KEY: 'InSecureDefaultNeverUseItInProduction!'
    depends_on:
      - database

  web:
    build: docker/nginx
    environment:
        UWSGI_PASS: app:8000
    depends_on:
      - app
    ports:
      - "8080:8080"
    volumes_from:
      - app:ro
